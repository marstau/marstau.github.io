---
layout: post
title: 透视投影变换
category: 编程开发
tags: Game　Engine
keywords: 
description: 
---

<span style="font-size:small;"><span style="color:black;"
lang="EN-US"><span
style="font-family:'Times New Roman';">From:<http://blog.csdn.net/popy007/article/details/1797121></span></span></span>

<span style="font-size:small;"><span style="color:black;"
lang="EN-US"><span
style="font-family:'Times New Roman';"></span></span></span> 

<span style="font-size:small;"><span style="color:black;"
lang="EN-US"><span
style="font-family:'Times New Roman';">-Twinsen</span></span><span
style="font-family:宋体;color:black;">编写</span></span><span
style="color:black;" lang="EN-US">\
 </span><span style="font-size:small;"><span style="color:black;"
lang="EN-US"><span
style="font-family:'Times New Roman';">-</span></span><span
style="font-family:宋体;color:black;">本人水平有限，疏忽错误在所难免，还请各位数学高手、编程高手不吝赐教</span></span><span
style="color:black;" lang="EN-US">\
 <span
style="font-family:'Times New Roman';font-size:small;">-email:<span
class="Apple-converted-space"> </span></span>[<span
style="font-family:'Times New Roman';font-size:small;">popyy@netease.com</span>](mailto:popyy@netease.com)</span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">透视投影是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">3D</span></span><span
style="font-family:宋体;">固定流水线的重要组成部分，是将相机空间中的点从视锥体</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">(frustum)</span></span><span
style="font-family:宋体;">变换到规则观察体</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">(Canonical
View Volume)</span></span><span
style="font-family:宋体;">中，待裁剪完毕后进行透视除法的行为。在算法中它是通过透视矩阵乘法和透视除法两步完成的。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">透视投影变换是令很多刚刚进入</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">3D</span></span><span
style="font-family:宋体;">图形领域的开发人员感到迷惑乃至神秘的一个图形技术。其中的理解困难在于步骤繁琐，对一些基础知识过分依赖，一旦对它们中的任何地方感到陌生，立刻导致理解停止不前。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">没错，主流的</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">3D APIs</span></span><span
style="font-family:宋体;">如</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">OpenGL</span></span><span
style="font-family:宋体;">、</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">D3D</span></span><span
style="font-family:宋体;">的确把具体的透视投影细节封装起来，比如</span></span>

<span style="font-size:small;"><span lang="EN-US"><span
style="font-family:'Times New Roman';">gluPerspective(…)</span></span><span
style="font-family:宋体;">就可以根据输入生成一个透视投影矩阵。而且在大多数情况下不需要了解具体的内幕算法也可以完成任务。但是你不觉得，如果想要成为一个职业的图形程序员或游戏开发者，就应该真正降伏透视投影这个家伙么？我们先从必需的基础知识着手，一步一步深入下去（这些知识在很多地方可以单独找到，但我从来没有在同一个地方全部找到，但是你现在找到了</span><span
style="font-family:Wingdings;" lang="EN-US"><span>J</span></span><span
style="font-family:宋体;">）。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">我们首先介绍两个必须掌握的知识。有了它们，我们才不至于在理解透视投影变换的过程中迷失方向（这里会使用到向量几何、矩阵的部分知识，如果你对此不是很熟悉，可以参考</span><span
lang="EN-US">[<span
style="font-family:宋体;">《向量几何在游戏编程中的使用》</span>](http://blog.csdn.net/popy007/)</span><span
style="font-family:宋体;">系列文章）。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

**<span style="font-size:small;"><span
style="font-family:宋体;">齐次坐标表示</span><span
lang="EN-US"></span></span>**

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-family:宋体;"><span
style="font-size:small;">透视投影变换是在齐次坐标下进行的，而齐次坐标本身就是一个令人迷惑的概念，这里我们先把它理解清楚。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">根据</span><span lang="EN-US">[<span
style="font-family:宋体;">《向量几何在游戏编程中的使用</span><span
style="font-family:'Times New Roman';">6</span><span
style="font-family:宋体;">》</span>](http://blog.csdn.net/popy007/archive/2005/05/20/376952.aspx)</span><span
style="font-family:宋体;">中关于基的概念。对于一个*向量*</span>**<span
lang="EN-US"><span
style="font-family:'Times New Roman';">v</span></span>**<span
style="font-family:宋体;">以及基</span>**<span lang="EN-US"><span
style="font-family:'Times New Roman';">oabc</span></span>**<span
style="font-family:宋体;">，</span></span>

<span style="font-size:small;"></span>

<span lang="EN-US"></span>

<span lang="EN-US"><span style="font-size:small;"><span
style="font-family:'Times New Roman';"></span></span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> ![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig1.GIF)</span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">可以找到一组坐标</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">(v1,v2,v3)</span></span><span
style="font-family:宋体;">，使得</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:'Times New Roman';">**<span
lang="EN-US">v</span>**<span lang="EN-US"><span
class="Apple-converted-space"> </span>= v1<span
class="Apple-converted-space"> </span>**a**<span
class="Apple-converted-space"> </span>+ v2<span
class="Apple-converted-space"> </span>**b +<span
class="Apple-converted-space"> </span>**v3**<span
class="Apple-converted-space"> </span>c<span
class="Apple-converted-space"> </span>**</span></span>**<span
style="font-family:宋体;">（</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">1</span></span><span
style="font-family:宋体;">）</span><span lang="EN-US"></span>**</span>

**<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>**

<span style="font-size:small;"><span
style="font-family:宋体;">而对于一个*点*</span>**<span
lang="EN-US"><span
style="font-family:'Times New Roman';">p</span></span>**<span
style="font-family:宋体;">，则可以找到一组坐标（</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">p1,p2,p3</span></span><span
style="font-family:宋体;">），使得</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:'Times New Roman';">**<span
lang="EN-US">p</span>**<span lang="EN-US"><span
class="Apple-converted-space"> </span>–<span
class="Apple-converted-space"> </span>**o**<span
class="Apple-converted-space"> </span>= p1<span
class="Apple-converted-space"> </span>**a +<span
class="Apple-converted-space"> </span>**p2<span
class="Apple-converted-space"> </span>**b**<span
class="Apple-converted-space"> </span>+ p3<span
class="Apple-converted-space"> </span>**c<span
class="Apple-converted-space"> </span>**</span></span>**<span
style="font-family:宋体;">（</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">2</span></span><span
style="font-family:宋体;">）</span><span lang="EN-US"></span>**</span>

**<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>**

<span style="font-size:small;"><span
style="font-family:宋体;">从上面对*向量*和*点*的表达，我们可以看出为了在坐标系中表示一个*点*（如</span>**<span
lang="EN-US"><span
style="font-family:'Times New Roman';">p</span></span>**<span
style="font-family:宋体;">），我们把点的位置看作是对这个基的原点</span>**<span
lang="EN-US"><span
style="font-family:'Times New Roman';">o</span></span>**<span
style="font-family:宋体;">所进行的一个位移，即一个向量——</span>**<span
lang="EN-US"><span style="font-family:'Times New Roman';">p –
o</span></span>**<span
style="font-family:宋体;">（有的书中把这样的向量叫做*位置向量*——起始于坐标原点的特殊向量），我们在表达这个向量的同时用等价的方式表达出了点</span><span
style="font-family:'Times New Roman';">**<span
lang="EN-US">p</span>**<span lang="EN-US">:****</span></span></span>

**<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>**

<span style="font-size:small;"><span
style="font-family:'Times New Roman';">**<span lang="EN-US">p<span
class="Apple-converted-space"> </span></span>**<span lang="EN-US">=<span
class="Apple-converted-space"> </span>**o**<span
class="Apple-converted-space"> </span>+ p1<span
class="Apple-converted-space"> </span>**a +<span
class="Apple-converted-space"> </span>**p2<span
class="Apple-converted-space"> </span>**b**<span
class="Apple-converted-space"> </span>+ p3<span
class="Apple-converted-space"> </span>**c (3)**</span></span></span>

**<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>**

**<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>**

<span style="font-size:small;"><span lang="EN-US"><span
style="font-family:'Times New Roman';">(1)(3)</span></span><span
style="font-family:宋体;">是坐标系下表达一个*向量*和*点*的不同表达方式。这里可以看出，虽然都是用代数分量的形式表达向量和点，但表达一个点比一个向量需要额外的信息。如果我写出一个代数分量表达</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">(1, 4,
7)</span></span><span
style="font-family:宋体;">，谁知道它是个向量还是个点！</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">我们现在把（</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">1</span></span><span
style="font-family:宋体;">）（</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">3</span></span><span
style="font-family:宋体;">）写成矩阵的形式：</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig2.GIF)</span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">这里</span>**<span lang="EN-US"><span
style="font-family:'Times New Roman';">(a,b,c,o)</span></span>**<span
style="font-family:宋体;">是坐标基矩阵，右边的列向量分别是向量</span>**<span
lang="EN-US"><span
style="font-family:'Times New Roman';">v</span></span>**<span
style="font-family:宋体;">和点</span>**<span lang="EN-US"><span
style="font-family:'Times New Roman';">p</span></span>**<span
style="font-family:宋体;">在基下的坐标。这样，向量和点在同一个基下就有了不同的表达：</span>*<span
lang="EN-US"><span
style="font-family:'Times New Roman';">3D</span></span><span
style="font-family:宋体;">向量</span>*<span
style="font-family:宋体;">的第</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">4</span></span><span
style="font-family:宋体;">个代数分量是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">0</span></span><span
style="font-family:宋体;">，而</span>*<span lang="EN-US"><span
style="font-family:'Times New Roman';">3D</span></span><span
style="font-family:宋体;">点</span>*<span
style="font-family:宋体;">的第</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">4</span></span><span
style="font-family:宋体;">个代数分量是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">1</span></span><span
style="font-family:宋体;">。像这种这种用</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">4</span></span><span
style="font-family:宋体;">个代数分量表示</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">3D</span></span><span
style="font-family:宋体;">几何概念的方式是一种齐次坐标表示。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;">*<span
style="font-family:宋体;">“齐次坐标表示是计算机图形学的重要手段之一，它既能够用来明确区分向量和点，同时也更易用于进行仿射（线性）几何变换。”——</span><span
style="font-family:'Times New Roman';"><span
class="Apple-converted-space"> </span></span>*<span lang="EN-US"><span
style="font-family:'Times New Roman';">F.S. Hill,
JR</span></span></span>

*<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>*

<span style="font-size:small;"><span
style="font-family:宋体;">这样，上面的</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(1, 4, 7)</span></span><span
style="font-family:宋体;">如果写成（</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">1,4,7,0</span></span><span
style="font-family:宋体;">），它就是个向量；如果是</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">(1,4,7,1)</span></span><span
style="font-family:宋体;">，它就是个点。</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">下面是如何在普通坐标</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">(Ordinary
Coordinate)</span></span><span
style="font-family:宋体;">和齐次坐标</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(Homogeneous
Coordinate)</span></span><span
style="font-family:宋体;">之间进行转换：</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-family:宋体;"><span
style="font-size:small;">从普通坐标转换成齐次坐标时，</span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">如果</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(x,y,z)</span></span><span
style="font-family:宋体;">是个点，则变为</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(x,y,z,1);</span></span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">如果</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(x,y,z)</span></span><span
style="font-family:宋体;">是个向量，则变为</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">(x,y,z,0)</span></span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-family:宋体;"><span
style="font-size:small;">从齐次坐标转换成普通坐标时，</span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">如果是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(x,y,z,1)</span></span><span
style="font-family:宋体;">，则知道它是个点，变成</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">(x,y,z);</span></span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">如果是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(x,y,z,0)</span></span><span
style="font-family:宋体;">，则知道它是个向量，仍然变成</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">(x,y,z)</span></span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">以上是通过齐次坐标来区分向量和点的方式。从中可以思考得知，对于平移</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">T</span></span><span
style="font-family:宋体;">、旋转</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">R</span></span><span
style="font-family:宋体;">、缩放</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">S</span></span><span
style="font-family:宋体;">这</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">3</span></span><span
style="font-family:宋体;">个最常见的仿射变换，平移变换只对于点才有意义，因为普通向量没有位置概念，只有大小和方向，这可以通过下面的式子清楚地看出：</span></span>

<span style="font-size:small;"></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-family:宋体;"></span>

<span style="font-family:宋体;"><span
style="font-size:small;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig3.GIF)</span></span>

<span style="font-family:宋体;"></span>

<span style="font-family:宋体;"></span>

<span style="font-family:宋体;"><span
style="font-size:small;">而旋转和缩放对于向量和点都有意义，你可以用类似上面齐次表示来检测。从中可以看出，齐次坐标用于仿射变换非常方便。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">此外，对于一个普通坐标的*点*</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">P=(Px, Py,
Pz)</span></span><span
style="font-family:宋体;">，有对应的一族齐次坐标</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">(wPx, wPy,
wPz, w)</span></span><span style="font-family:宋体;">，其中</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">w</span></span><span
style="font-family:宋体;">不等于零。比如，</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">P(1, 4,
7)</span></span><span style="font-family:宋体;">的齐次坐标有</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">(1, 4, 7,
1)</span></span><span style="font-family:宋体;">、（</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">2, 8, 14,
2</span></span><span style="font-family:宋体;">）、（</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">-0.1, -0.4, -0.7, -0.1</span></span><span
style="font-family:宋体;">）等等。因此，如果把一个点从普通坐标变成齐次坐标，给</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">x,y,z</span></span><span
style="font-family:宋体;">乘上同一个非零数</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">w</span></span><span
style="font-family:宋体;">，然后增加第</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">4</span></span><span
style="font-family:宋体;">个分量</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">w</span></span><span
style="font-family:宋体;">；如果把一个齐次坐标转换成普通坐标，把前三个坐标同时除以第</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">4</span></span><span
style="font-family:宋体;">个坐标，然后去掉第</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">4</span></span><span
style="font-family:宋体;">个分量。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">由于齐次坐标使用了</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">4</span></span><span
style="font-family:宋体;">个分量来表达</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">3D</span></span><span
style="font-family:宋体;">概念，使得平移变换可以使用矩阵进行，从而如</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">F.S. Hill,
JR</span></span><span
style="font-family:宋体;">所说，仿射（线性）变换的进行更加方便。由于图形硬件已经普遍地支持齐次坐标与矩阵乘法，因此更加促进了齐次坐标使用，使得它似乎成为图形学中的一个标准。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

**<span style="font-size:small;"><span
style="font-family:宋体;">简单的线性插值</span><span
lang="EN-US"></span></span>**

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">这是在图形学中普遍使用的基本技巧，我们在很多地方都会用到，比如</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">2D</span></span><span
style="font-family:宋体;">位图的放大、缩小，</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">Tweening</span></span><span
style="font-family:宋体;">变换，以及我们即将看到的透视投影变换等等。基本思想是：给一个</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">属于</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[a, b]</span></span><span
style="font-family:宋体;">，找到</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">属于</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[c, d]</span></span><span
style="font-family:宋体;">，使得</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">与</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">a</span></span><span
style="font-family:宋体;">的距离比上</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">ab</span></span><span
style="font-family:宋体;">长度所得到的比例，等于</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">与</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">c</span></span><span
style="font-family:宋体;">的距离比上</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">cd</span></span><span
style="font-family:宋体;">长度所得到的比例，用数学表达式描述很容易理解：</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig4.GIF)</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">这样，从</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">a</span></span><span
style="font-family:宋体;">到</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">b</span></span><span
style="font-family:宋体;">的每一个点都与</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">c</span></span><span
style="font-family:宋体;">到</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">d</span></span><span
style="font-family:宋体;">上的唯一一个点对应。有一个</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">，就可以求得一个</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">。</span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">此外，如果</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">不在</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[a, b]</span></span><span
style="font-family:宋体;">内，比如</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x \< a</span></span><span
style="font-family:宋体;">或者</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x \> b</span></span><span
style="font-family:宋体;">，则得到的</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">也是符合</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y \< c</span></span><span
style="font-family:宋体;">或者</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y \> d</span></span><span
style="font-family:宋体;">，比例仍然不变，插值同样适用。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

**<span style="font-family:宋体;"><span
style="font-size:small;">透视投影变换</span></span>**

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">好，有了上面两个理论知识，我们开始分析这次的主角——透视投影变换。这里我们选择</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">OpenGL</span></span><span
style="font-family:宋体;">的透视投影变换进行分析，其他的</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">APIs</span></span><span
style="font-family:宋体;">会存在一些差异，但主体思想是相似的，可以类似地推导。经过相机矩阵的变换，顶点被变换到了相机空间。这个时候的多边形也许会被视锥体裁剪，但在这个不规则的体中进行裁剪并非那么容易的事情，所以经过图形学前辈们的精心分析，裁剪被安排到规则观察体</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">(Canonical
View Volume, CVV)</span></span><span
style="font-family:宋体;">中进行，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">是一个正方体，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x, y, z</span></span><span
style="font-family:宋体;">的范围都是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[-1</span></span><span
style="font-family:宋体;">，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">1]</span></span><span
style="font-family:宋体;">，多边形裁剪就是用这个规则体完成的。所以，事实上是透视投影变换由两步组成：</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span lang="EN-US"><span><span
style="font-family:'Times New Roman';"><span
style="font-size:small;">1）</span><span
style="font:7pt 'Times New Roman';"> <span
class="Apple-converted-space"> </span></span></span></span></span><span
style="font-size:small;"><span
style="font-family:宋体;">用透视变换矩阵把顶点从视锥体中变换到裁剪空间的</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">中。</span></span>

<span style="font-family:'Times New Roman';"><span
lang="EN-US"><span><span style="font-size:small;">2）</span><span
style="font:7pt 'Times New Roman';"> <span
class="Apple-converted-space"> </span></span></span></span><span
lang="EN-US"><span
style="font-size:small;">CVV</span></span></span><span
style="font-family:宋体;"><span
style="font-size:small;">裁剪完成后进行*透视除法*（一会进行解释）。</span></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-family:宋体;"></span>

<span style="font-family:宋体;"><span style="font-size:small;">**<span
style="font-size:small;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig5.GIF)</span>**</span></span>

<span style="font-family:宋体;"><span
style="font-size:small;">我们一步一步来，我们先从一个方向考察投影关系。</span></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig6.GIF)</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">上图是右手坐标系中顶点在相机空间中的情形。设</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">P(x,z)</span></span><span
style="font-family:宋体;">是经过相机变换之后的点，视锥体由</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">eye</span></span><span
style="font-family:宋体;">——眼睛位置，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">np</span></span><span
style="font-family:宋体;">——近裁剪平面，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">fp</span></span><span
style="font-family:宋体;">——远裁剪平面组成。</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">N</span></span><span
style="font-family:宋体;">是眼睛到近裁剪平面的距离，</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">F</span></span><span
style="font-family:宋体;">是眼睛到远裁剪平面的距离。投影面可以选择任何平行于近裁剪平面的平面，这里我们选择近裁剪平面作为投影平面。设</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">P’(x’,z’)</span></span><span
style="font-family:宋体;">是投影之后的点，则有</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">z’
= -N</span></span><span
style="font-family:宋体;">。通过相似三角形性质，我们有关系：</span></span>

<span style="font-size:small;"><span style="font-family:宋体;"><span
style="font-family:'Times New Roman';font-size:10.5pt;"
lang="EN-US">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig7.GIF)</span></span></span>

<span lang="EN-US"></span>

<span style="font-family:宋体;"></span>

<span style="font-family:宋体;"><span
style="font-size:small;">同理，有</span></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig8.GIF)</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">这样，我们便得到了</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">P</span></span><span
style="font-family:宋体;">投影后的点</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">P’</span></span></span>

<span style="font-family:'Times New Roman';font-size:small;"></span>

<span style="font-family:'Times New Roman';font-size:small;"><span
lang="EN-US">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig9.GIF)</span></span>

<span style="font-family:'Times New Roman';font-size:small;"></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">从上面可以看出，投影的结果</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z’</span></span><span
style="font-family:宋体;">始终等于</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">-N</span></span><span
style="font-family:宋体;">，在投影面上。实际上，</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z’</span></span><span
style="font-family:宋体;">对于投影后的</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">P’</span></span><span
style="font-family:宋体;">已经没有意义了，这个信息点已经没用了。但对于</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">3D</span></span><span
style="font-family:宋体;">图形管线来说，为了便于进行后面的片元操作，例如</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">缓冲消隐算法，有必要把投影之前的</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">保存下来，方便后面使用。因此，我们利用这个没用的信息点存储</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">，处理成：</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span style="font-family:宋体;">**<span
style="font-size:small;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig10.GIF)</span>**</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"></span><span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">这个形式最大化地使用了</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">3</span></span><span
style="font-family:宋体;">个信息点，达到了最原始的投影变换的目的，但是它太直白了，有一点蛮干的意味，我感觉我们最终的结果不应该是它，你说呢？我们开始结合</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">进行思考，把它写得在数学上更优雅一致，更易于程序处理。假入能够把上面写成这个形式：</span></span>

<span style="font-size:small;"></span><span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig11.GIF) </span></span>

<span style="font-family:宋体;"><span
style="font-size:small;">那么我们就可以非常方便的用矩阵以及齐次坐标理论来表达投影变换：</span></span>

 

<span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig12.GIF)</span>

 

<span style="font-family:宋体;"><span
style="font-size:small;">其中</span></span>

 

<span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig13.GIF)</span>

 

<span style="font-size:small;"><span
style="font-family:宋体;">哈，看到了齐次坐标的使用，这对于你来说已经不陌生了吧？这个新的形式不仅达到了上面原始投影变换的目的，而且使用了齐次坐标理论，使得处理更加规范化。注意在把![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig14.GIF)</span><span
style="font-family:宋体;">变成![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig15.GIF)</span><span
style="font-family:宋体;">的一步我们是使用齐次坐标变普通坐标的规则完成的。这一步在透视投影过程中称为*透视除法（*</span>*<span
lang="EN-US"><span style="font-family:'Times New Roman';">Perspective
Division</span></span><span style="font-family:宋体;">）</span>*<span
style="font-family:宋体;">，这是透视投影变换的第</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">2</span></span><span
style="font-family:宋体;">步，经过这一步，就丢弃了原始的</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">值（得到了</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">中对应的</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">值，后面解释），顶点才算完成了投影。而在这两步之间的就是</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">裁剪过程，所以裁剪空间使用的是齐次坐标![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig16.GIF)</span><span
style="font-family:宋体;">，主要原因在于透视除法会损失一些必要的信息（如原始</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">，第</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">4</span></span><span
style="font-family:宋体;">个</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">-z</span></span><span
style="font-family:宋体;">保留的）从而使裁剪变得更加难以处理，这里我们不讨论</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">裁剪的细节，只关注透视投影变换的两步。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-family:宋体;"><span
style="font-size:small;">矩阵</span></span>

<span style="font-family:宋体;"></span>

<span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig17.GIF)</span>

<span style="font-family:宋体;"></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">就是我们投影矩阵的第一个版本。你一定会问为什么要把</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">写成</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig18.GIF)</span></span>

<span style="font-size:small;"></span><span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-family:宋体;"><span
style="font-size:small;">有两个原因：</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-family:'Times New Roman';"><span
lang="EN-US"><span><span style="font-size:small;">1）</span><span
style="font:7pt 'Times New Roman';"> <span
class="Apple-converted-space"> </span></span></span></span><span
lang="EN-US"><span style="font-size:small;">P’</span></span></span><span
style="font-size:small;"><span style="font-family:宋体;">的</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">3</span></span><span
style="font-family:宋体;">个代数分量统一地除以分母</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">-z</span></span><span
style="font-family:宋体;">，易于使用齐次坐标变为普通坐标来完成，使得处理更加一致、高效。</span></span>

<span lang="EN-US"><span><span
style="font-family:'Times New Roman';"><span
style="font-size:small;">2）</span><span
style="font:7pt 'Times New Roman';"> <span
class="Apple-converted-space"> </span></span></span></span></span><span
style="font-size:small;"><span
style="font-family:宋体;">后面的</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">是一个</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x,y,z</span></span><span
style="font-family:宋体;">的范围都为</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[-1</span></span><span
style="font-family:宋体;">，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">1]</span></span><span
style="font-family:宋体;">的规则体，便于进行多边形裁剪。而我们可以适当的选择系数</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">a</span></span><span
style="font-family:宋体;">和</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">b</span></span><span
style="font-family:宋体;">，使得![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig19.GIF)</span><span
style="font-family:宋体;">这个式子在</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">z = -N</span></span><span
style="font-family:宋体;">的时候值为</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">-1</span></span><span
style="font-family:宋体;">，而在</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">z = -F</span></span><span
style="font-family:宋体;">的时候值为</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">1</span></span><span
style="font-family:宋体;">，从而在</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">方向上构建</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">接下来我们就求出</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">a</span></span><span
style="font-family:宋体;">和</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">b</span></span><span
style="font-family:宋体;">：</span></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig20.GIF) </span></span>

<span style="font-family:宋体;"><span
style="font-size:small;">这样我们就得到了透视投影矩阵的第一个版本：</span></span>

<span style="font-family:宋体;"></span>

<span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig21.GIF)</span>

<span style="font-family:宋体;"></span>

<span lang="EN-US"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">使用这个版本的透视投影矩阵可以从</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">z</span></span><span
style="font-family:宋体;">方向上构建</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">，但是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">和</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">方向仍然没有限制在</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">[-1,1]</span></span><span
style="font-family:宋体;">中，我们的透视投影矩阵的下一个版本就要解决这个问题。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">为了能在</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">和</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">方向把顶点从</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">Frustum</span></span><span
style="font-family:宋体;">情形变成</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">情形，我们开始对</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">和</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">进行处理。先来观察我们目前得到的最终变换结果：</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span style="font-family:宋体;"><span
style="font-family:'Times New Roman';font-size:10.5pt;"
lang="EN-US">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig22.GIF)</span></span></span>

<span style="font-size:small;"></span>

<span lang="EN-US"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">我们知道</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">-Nx / z</span></span><span
style="font-family:宋体;">的有效范围是投影平面的左边界值（记为</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">left</span></span><span
style="font-family:宋体;">）和右边界值（记为</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">right</span></span><span
style="font-family:宋体;">），即</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[left, right]</span></span><span
style="font-family:宋体;">，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">-Ny / z</span></span><span
style="font-family:宋体;">则为</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[bottom, top]</span></span><span
style="font-family:宋体;">。而现在我们想把</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">-Nx /
z</span></span><span style="font-family:宋体;">属于</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">[left,
right]</span></span><span style="font-family:宋体;">映射到</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">属于</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[-1, 1]</span></span><span
style="font-family:宋体;">中，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">-Ny / z</span></span><span
style="font-family:宋体;">属于</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[bottom, top]</span></span><span
style="font-family:宋体;">映射到</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">属于</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">[-1, 1]</span></span><span
style="font-family:宋体;">中。你想到了什么？哈，就是我们简单的线性插值，你都已经掌握了！我们解决掉它：</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig23.GIF)</span></span>
**(左边的x是投影之前的,右边的x是投影之后的x')**

<span style="font-size:small;"></span>

<span style="font-size:small;"></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-family:宋体;"><span
style="font-size:small;">则我们得到了最终的投影点：</span></span>

 

<span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig24.GIF)</span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">下面要做的就是从这个新形式出发反推出下一个版本的透视投影矩阵。注意到![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig25.GIF)</span><span
style="font-family:宋体;">是![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig26.GIF)</span><span
style="font-family:宋体;">经过透视除法的形式，而</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">P’</span></span><span
style="font-family:宋体;">只变化了</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">x</span></span><span
style="font-family:宋体;">和</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">y</span></span><span
style="font-family:宋体;">分量的形式，</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">az+b</span></span><span
style="font-family:宋体;">和</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">-z</span></span><span
style="font-family:宋体;">是不变的，则我们做透视除法的逆处理——给</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">P’</span></span><span
style="font-family:宋体;">每个分量乘上</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">-z</span></span><span
style="font-family:宋体;">，得到</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig27.GIF)</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-family:宋体;"><span
style="font-size:small;">而这个结果又是这么来的：</span></span>

<span style="font-family:宋体;"></span>

<span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig28.GIF)</span>

<span style="font-family:宋体;"></span>

<span lang="EN-US"></span>

<span style="font-family:宋体;"><span
style="font-size:small;">则我们最终得到：</span></span>

<span style="font-family:宋体;"></span>

<span style="font-family:宋体;"></span>

<span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig29.GIF)</span>

<span style="font-family:宋体;"></span>

<span lang="EN-US"></span>

<span lang="EN-US"></span>

<span style="font-size:small;"><span lang="EN-US"><span
style="font-family:'Times New Roman';">M</span></span><span
style="font-family:宋体;">就是最终的透视变换矩阵。相机空间中的顶点，如果在视锥体中，则变换后就在</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">中。如果在视锥体外，变换后就在</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">外。而</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">本身的规则性对于多边形的裁剪很有利。</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">OpenGL</span></span><span
style="font-family:宋体;">在构建透视投影矩阵的时候就使用了</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">M</span></span><span
style="font-family:宋体;">的形式。注意到</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">M</span></span><span
style="font-family:宋体;">的最后一行不是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(0 0 0 1)</span></span><span
style="font-family:宋体;">而是</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(0 0 -1 0)</span></span><span
style="font-family:宋体;">，因此可以看出透视变换不是一种仿射变换，它是非线性的。另外一点你可能已经想到，对于投影面来说，它的宽和高大多数情况下不同，即宽高比不为</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">1</span></span><span
style="font-family:宋体;">，比如</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">640/480</span></span><span
style="font-family:宋体;">。而</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">的宽高是相同的，即宽高比永远是</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">1</span></span><span
style="font-family:宋体;">。这就造成了多边形的失真现象，比如一个投影面上的正方形在</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">CVV</span></span><span
style="font-family:宋体;">的面上可能变成了一个长方形。解决这个问题的方法就是在对多变形进行透视变换、裁剪、透视除法之后，在归一化的设备坐标</span><span
lang="EN-US"><span style="font-family:'Times New Roman';">(Normalized
Device Coordinates)</span></span><span
style="font-family:宋体;">上进行的视口</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">(viewport)</span></span><span
style="font-family:宋体;">变换中进行校正，它会把归一化的顶点之间按照和投影面上相同的比例变换到视口中，从而解除透视投影变换带来的失真现象。进行校正前提就是要使投影平面的宽高比和视口的宽高比相同。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

**<span style="font-size:small;"><span
style="font-family:宋体;">便利的投影矩阵生成函数</span><span
lang="EN-US"></span></span>**

**<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>**

<span style="font-size:small;"><span lang="EN-US"><span
style="font-family:'Times New Roman';">3D APIs</span></span><span
style="font-family:宋体;">都提供了诸如</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">gluPerspective(fov, aspect, near,
far)</span></span><span style="font-family:宋体;">或者</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">D3DXMatrixPerspectiveFovLH(pOut,
fovY, Aspect, zn, zf)</span></span><span
style="font-family:宋体;">这样的函数为用户提供快捷的透视矩阵生成方法。我们还是用</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">OpenGL</span></span><span
style="font-family:宋体;">的相应方法来分析它是如何运作的。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;">gluPerspective(fov,
aspect, near, far)</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span lang="EN-US"><span
style="font-family:'Times New Roman';">fov</span></span><span
style="font-family:宋体;">即视野，是视锥体在</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">xz</span></span><span
style="font-family:宋体;">平面或者</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">yz</span></span><span
style="font-family:宋体;">平面的开角角度，具体哪个平面都可以。</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">OpenGL</span></span><span
style="font-family:宋体;">和</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">D3D</span></span><span
style="font-family:宋体;">都使用</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">yz</span></span><span
style="font-family:宋体;">平面。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span lang="EN-US"><span
style="font-family:'Times New Roman';">aspect</span></span><span
style="font-family:宋体;">即投影平面的宽高比。</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span lang="EN-US"><span
style="font-family:'Times New Roman';">near</span></span><span
style="font-family:宋体;">是近裁剪平面的距离</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span lang="EN-US"><span
style="font-family:'Times New Roman';">far</span></span><span
style="font-family:宋体;">是远裁剪平面的距离。</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">![](http://p.blog.csdn.net/images/p_blog_csdn_net/popy007/fig30.GIF)</span></span>

<span style="font-size:small;"></span>

<span style="font-size:small;"><span
style="font-family:宋体;">上图中左边是在</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">xz</span></span><span
style="font-family:宋体;">平面计算视锥体，右边是在</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">yz</span></span><span
style="font-family:宋体;">平面计算视锥体。可以看到左边的第</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">3</span></span><span
style="font-family:宋体;">步</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">top = right /
aspect</span></span><span
style="font-family:宋体;">使用了除法（图形程序员讨厌的东西），而右边第</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">3</span></span><span
style="font-family:宋体;">步</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">right = top x
aspect</span></span><span
style="font-family:宋体;">使用了乘法，这也许就是为什么图形</span><span
lang="EN-US"><span
style="font-family:'Times New Roman';">APIs</span></span><span
style="font-family:宋体;">采用</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">yz</span></span><span
style="font-family:宋体;">平面的原因吧！</span></span>

<span lang="EN-US"><span
style="font-family:'Times New Roman';font-size:small;"> </span></span>

<span style="font-size:small;"><span
style="font-family:宋体;">到目前为止已经完成了对透视投影变换的阐述，我想如果你一直跟着我的思路下来，应该能够对透视投影变换有一个细节层次上的认识。当然，很有可能你已经是一个透视投影变换专家，如果是这样的话，一定给我写信，指出我认识上的不足，我会非常感激</span><span
style="font-family:Wingdings;" lang="EN-US"><span>J</span></span><span
style="font-family:宋体;">。</span><span lang="EN-US"><span
style="font-family:'Times New Roman';">Bye!</span></span></span>

 

 






