---
layout: post
title: Unity3D优化
category: 编程开发
tags: unity3d
keywords: 
description: 
---

#### Unity官文对AB包大小的建议是如果放在远程的话1~2MB之间，如果放在本地的话5~10MB之间，不要超过10MB不然可能会有问题。[More](https://sunweizhe.cn/2020/05/21/%E7%BB%86%E8%AF%B4Unity%E4%B8%AD%E7%9A%84Asset/)


#### ETC2对于支持OpenGL ES3.0的Android移动设备来说，是一个很好的处理半透明的纹理格式。但是，如果你的游戏需要在大量OpenGL ES2.0的设备上进行运行，那么我们不建议使用ETC2格式纹理。因为不仅会造成大量的内存占用（ETC2转成RGBA32), 同时也增加一定的加载时间。[More](https://xinzhuzi.github.io/2020/05/08/Unity/Optimize/UWA%E4%BC%98%E5%8C%96/)


#### 2.将需要alpha和不需要alpha的图拆分开来做图集，不需要alpha的的图集可以大幅度的做压缩处理，因为这些图像压缩后看起来不会太糟糕。而有alpha的图集压缩会使得图像差别比较大。这样可以减少内存占用。[More](https://www.jianshu.com/p/1e58e995c1f8)

#### 纹理内存占用查看 详解Unity-Profiler内存分析问题[More](https://hcq0618.github.io/blog/categories/Unity%E4%BC%98%E5%8C%96/page/6/)

```
我们在Editor中调试项目的时候发现纹理的内存大小是其本身大小的两倍，是因为Unity把内存和显存的大小都计算进去了吗？
```
其实并不是这个原因，因为Editor本身会保有纹理的一份内存，在Editor下进行Profiler会把Editor本身所使用的纹理大小也计算进去，因此会有内存变为两倍的情况。我们官方并不建议在Editor下对项目进行性能调试，而是务必要在真机上跑编译好的项目，然后连接Profiler进行调试，只有这样才能得到真正精确的测试数据。

#### 通过未压缩的Bundle文件，同步创建AssetBundle对象，这是最快的创建方式。创建完成后只会在内存中创建较小的SerializedFile，而后续的AssetBundle.Load需要通过IO从磁盘中获取。[More](https://blog.uwa4d.com/archives/ABTheory.html)

#### 尽可能避免使用UI/Effect，特别是Outline，会使得文本的Mesh增加4倍，导致UI重建开销明显增大；[More](https://davidsheh.github.io/post/unity-ugui-optimize/)

#### 2D Lights[More](https://www.youtube.com/watch?v=OfaqrawYOxQ)

```

```

#### 音频优化[More](https://zhuanlan.zhihu.com/p/362941227)

#### 粒子系统的高消耗模块

```
Noise module
```

#### spine优化

[合批优化](https://answer.uwa4d.com/question/6100d3094f8c177460171597)
[【Unity】Unity引擎中Spine加载的深度优化实战](https://zhuanlan.zhihu.com/p/608786238)
[如何有效降低Spine动画的堆内存分配](https://c.m.163.com/news/a/HHQFHFAL0511L9VL.html)


#### 禁用不必要的物理设置[More](https://zhuanlan.zhihu.com/p/403433893)

如果游戏不使用物理设置，请取消选中 Auto Simulation 和 Auto Sync Transforms。否则它们会降低应用程序运行速度，却并无任何可见的好处。

#### 内存优化[More](https://cloud.tencent.com/developer/article/1359374)

```
 一个相对中大型的游戏，系统非常的多。这时候合理的适时的释放内存有助于游戏的正常体验，甚至可以防止内存快速到达峰值，导致设备Crash。

 目前主流平台机型可用内存：

 Android平台：在客户端最低配置以上，均需满足以下内存消耗指标（PSS）：

 1)内存1G以下机型：最高PSS<=150MB

 2)内存2G的机型：最高PSS<=200MB

 iOS平台：在iPhone4S下运行，消耗内存（real mem）不大于150MB

1.场景切换时避开峰值。

 当前一个场景还未释放的时候，切换到新的场景。这时候由于两个内存叠加很容易达到内存峰值。解决方案是，在屏幕中间遮盖一个Loading场景。在旧的释放完，并且新的初始化结束后，隐藏Loading场景，使之有效的避开内存大量叠加超过峰值。
```

#### 内存管理[More](https://jingxuanwang.github.io/2014/05/02/unity-memory-management)

```
在适当的时机主动触发GC

主动触发System.GC.Collect在大多数时候都不是一个好主意，但是也有一些例外的情况。 在不影响用户体验的前提下，主动触发GC可以防止GC发生在预期之外的地方。

防止Memory Spike
Unity内存管理中的另外一个话题是突然的内存增加(Memory Spike)导致游戏Crash。 这方面可用的策略比较灵活，这里简单介绍几个。

先弃后取
这个策略最经典的应用是在Scene Loading上边。 Unity的Scene Loading是先将Scene的内容加载进来，然后再释放掉之前Scene上的资源。 因此如果直接使用Application.LoadLevel之类的函数有可能会导致两个Scene的资源同时出现在内存中，此时非常容易Crash。 很多游戏在Scene切换的时候会引入一个Loading Scene，然后再加载下一个Scene，这样可以防止两个充满了资源的Scene的所有内容被同时加载到内存中。

化整为零
一般来说，加载巨大的单个资源比较容易出问题。 因此将单个的资源进行细分，根据当前的内存状况进行加载会使问题得到很大缓解。
```

创建出来的材质球需要手动Destroy掉,否则一直存在内存中.[More](https://zhuanlan.zhihu.com/p/603748892)
```
foreach (Material material in materials){
    Destroy(material);
}
```

## Reference

* [UWA优化](https://xinzhuzi.github.io/2020/05/08/Unity/Optimize/UWA%E4%BC%98%E5%8C%96/)
* [unity 2d项目中关于sprite的一些性能方面的问题](https://icode.best/i/33206551342020)
* [Unity-性能优化](https://www.cnblogs.com/Jaysonhome/p/13503452.html)
* [Unity3D 实用技巧 - 优化实践之路（一）](https://developer.unity.cn/projects/6409ebf8edbc2a6b5d462313)
* [unity-asset-checker-win-latest](https://upr.unity.cn/instructions/assetchecker)
* [UPR Desktop](https://upr.unity.cn/instructions/desktop)
* [移动端游戏性能优化——ARPG项目的优化经验](https://juejin.cn/post/7083135492300439559)
* [UWA发布 | Unity手游性能蓝皮书](https://blog.uwa4d.com/archives/BlueBook_2022.html)
* [九、性能优化相关知识](https://zhuanlan.zhihu.com/p/157877557)
* [drawcall 带宽优化](https://wetest.qq.com/labs/315)
* [Unity游戏内存回收的优化](https://duanyiliang.com/2017/11/18/optimizing_garbage_collection_in_unity_games/)